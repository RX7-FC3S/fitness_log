import{c as Z,u as ee,a as F,b as re,r as v,d as de,e as ue,o as ve,w as Q,f as pe,g as S,h as t,i as d,j as s,F as X,k as Y,l as k,m as W,n as me,p as E,q as b,s as D,v as h,t as T,x as fe,y as w,z as ce,_ as ge}from"./index-B2-oSflo.js";import{P as ye,a as ke,T as we}from"./trash-2-zQpmGgqF.js";const be=Z("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const xe=Z("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);function Se(){const $=de(),x=ee(),i=v(null),m=()=>i.value?.primaryMuscles?.length?N(i.value.primaryMuscles):x.primaryMuscles||[],N=l=>l.map(n=>typeof n=="object"?n.name:String(n)),P=()=>{const l=m();l.length?x.setPageTitle(l.join(" + ")):x.setPageTitle("")},C=async l=>{try{const n=l?await F.getFitnessDay(l):await F.getTodayFitnessDay();i.value=n,P()}catch(n){console.error("Failed to load training data",n)}finally{x.hideLoading()}},L=re(()=>{const l=m();return l.length?[...x.exercises].sort((n,p)=>{const c=l.includes(n.targetMuscle),I=l.includes(p.targetMuscle);return c===I?n.name.localeCompare(p.name):c?-1:1}):x.exercises});return{dayData:i,sortedExercises:L,loadData:C,addSet:async l=>{const n={fitness_day_id:i.value?.id||void 0,exercise_id:Number(l.exercise_id),set_type:l.set_type,weight:Number(l.weight),reps:Number(l.reps),unit_id:Number(l.unit_id),remark:"",primary_muscles:m()},p=await F.createFitnessSet(n);return!i.value?.id&&p.fitnessDayId?$.replace(`/training/${p.fitnessDayId}`):await C(i.value?.id||p.fitnessDayId),p},finishTraining:async()=>{await F.finishFitnessDay(),$.replace("/")},deleteSet:async(l,n)=>{await F.deleteFitnessSet(l),n?$.replace("/"):await C(i.value?.id)},updateSet:async(l,n)=>{await F.updateFitnessSet(l,n),await C(i.value?.id)},resolvePrimaryMuscles:m}}const Te={class:"training-page"},Ce={class:"form-grid-2"},Ve={class:"form-grid-3"},Fe={class:"scroll-area",id:"sets-list-container"},_e={class:"group-title f-title"},Ie={class:"set-card-content"},De={class:"set-info-row"},he={class:"set-details"},$e={key:0,class:"set-remark"},Pe={class:"set-actions"},Me={key:0,class:"empty-state"},Ue={class:"dialog-content"},ze={class:"form-group"},Be={class:"dialog-actions"},Ee={key:0,class:"dialog-title f-title is-primary"},Ne={class:"form-group"},Le={class:"form-group"},Re={class:"form-group"},je={class:"form-group"},Ae={class:"dialog-actions"},He={key:0,class:"dialog-content"},qe={class:"dialog-actions-vertical"},We={key:1,class:"dialog-content"},Ge={class:"dialog-actions"},Je=ue({__name:"Training",setup($){const x=me(),i=ee(),{dayData:m,sortedExercises:N,loadData:P,addSet:C,finishTraining:L,deleteSet:G,updateSet:R}=Se(),o=v({exerciseId:"",setType:i.setTypes[0]?.value||"正式组",unitId:i.units[0]?.id||1,weight:"",reps:""}),_=v(!1),l=v(!1),n=v(!1),p=v(!1),c=v(null),I=v(null),u=v({setType:"",weight:0,unitId:1,reps:0,remark:""}),j=v(!1),A=v(!1),M=v(!1),U=v(!1),V=v(!1),H=v(!1),ae=async()=>{if(!o.value.exerciseId||o.value.weight===""||!o.value.reps){_.value=!0;return}A.value=!0;try{await C({exercise_id:o.value.exerciseId,set_type:o.value.setType||"正式组",weight:o.value.weight,reps:o.value.reps,unit_id:String(o.value.unitId)}),setTimeout(()=>{const r=document.getElementById("sets-list-container");r&&(r.scrollTop=r.scrollHeight)},100)}finally{A.value=!1}},se=r=>{c.value=r,u.value.remark=r.remark||"",l.value=!0},le=async()=>{if(c.value){M.value=!0;try{await R(c.value.id,{remark:u.value.remark}),l.value=!1}finally{M.value=!1}}},te=(r,e)=>{I.value=r,c.value=e,u.value={setType:String(e.setType),weight:e.weight,unitId:typeof e.unit=="object"?e.unit.id:Number(e.unitId),reps:e.reps,remark:e.remark||""},n.value=!0},ie=async()=>{if(c.value){U.value=!0;try{await R(c.value.id,{set_type:u.value.setType,weight:u.value.weight,unit_id:u.value.unitId,reps:u.value.reps}),n.value=!1}finally{U.value=!1}}},ne=r=>{c.value={id:r};let e=0;m.value&&m.value.exercises.forEach(g=>e+=g.sets.length),j.value=e===1,p.value=!0},J=async()=>{if(c.value){V.value=!0;try{await G(c.value.id,j.value),p.value=!1}finally{V.value=!1}}},oe=async()=>{H.value=!0;try{await L()}finally{H.value=!1}},K=r=>{const e=i.setTypes.find(z=>z.value===r)?.label||r;let g="badge-working";return r.includes("热身")&&(g="badge-warmup"),r.includes("失败")&&(g="badge-failure"),r.includes("递减")&&(g="badge-drop"),{label:e,class:g}},q=()=>{i.setPageFooter([m.value?.id?{key:"finish",label:"结束训练",variant:"secondary",class:"flex-1",icon:be,onClick:oe,loading:H}:null,{key:"add",label:"添加此组",variant:"primary",class:m.value?.id?"flex-2":"flex-1",icon:ye,onClick:ae,loading:A}].filter(Boolean))};return ve(async()=>{i.setPageTitle(""),i.setFooterVisible(!0),await P(x.params.id),q(),i.setTypes.length>0&&i.setTypes[0]&&(o.value.setType=i.setTypes[0].value)}),Q(()=>x.params.id,async r=>{await P(r),q()}),Q(()=>m.value?.id,()=>{q()}),pe(()=>{i.clearPageFooter()}),(r,e)=>{const g=E("FSelect"),z=E("FCard"),y=E("FButton"),B=E("FDialog");return b(),S("div",Te,[t(z,{variant:"header",class:"header-card"},{default:d(()=>[s("div",Ce,[t(g,{modelValue:o.value.exerciseId,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.exerciseId=a),options:k(N).map(a=>({value:a.id,label:a.name})),placeholder:"选择动作..."},null,8,["modelValue","options"]),t(g,{modelValue:o.value.setType,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.setType=a),options:k(i).setTypes},null,8,["modelValue","options"])]),s("div",Ve,[t(g,{modelValue:o.value.unitId,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.unitId=a),options:k(i).units.map(a=>({value:a.id,label:a.name}))},null,8,["modelValue","options"]),D(s("input",{type:"number",class:"form-input",placeholder:"重量",step:"0.5","onUpdate:modelValue":e[3]||(e[3]=a=>o.value.weight=a)},null,512),[[h,o.value.weight]]),D(s("input",{type:"number",class:"form-input",placeholder:"次数","onUpdate:modelValue":e[4]||(e[4]=a=>o.value.reps=a)},null,512),[[h,o.value.reps]])])]),_:1}),s("div",Fe,[(b(!0),S(X,null,Y(k(m)?.exercises,a=>(b(),S("div",{key:a.exercise.id,class:"exercise-group"},[s("h4",_e,T(a.exercise.name),1),(b(!0),S(X,null,Y(a.sets,f=>(b(),fe(z,{key:f.id,class:"set-card",padding:"0.75rem 1rem",margin:"0 0 0.5rem 0","border-radius":"1rem"},{default:d(()=>[s("div",Ie,[s("div",De,[s("span",he,[w(T(f.weight)+" ",1),s("span",null,T(typeof f.unit=="object"?f.unit.name:f.unit),1),e[19]||(e[19]=s("span",{class:"multiply-sign"},"×",-1)),w(" "+T(f.reps)+" ",1),e[20]||(e[20]=s("span",null,"次",-1))]),s("span",{class:ce(["set-type-badge",K(String(f.setType)).class])},T(K(String(f.setType)).label),3)]),f.remark?(b(),S("div",$e,T(f.remark),1)):W("",!0)]),s("div",Pe,[t(y,{variant:"ghost",size:"icon",onClick:O=>se(f)},{default:d(()=>[t(k(xe),{size:18})]),_:1},8,["onClick"]),t(y,{variant:"ghost",size:"icon",onClick:O=>te(a.exercise,f)},{default:d(()=>[t(k(ke),{size:18})]),_:1},8,["onClick"]),t(y,{variant:"danger",size:"icon",onClick:O=>ne(f.id)},{default:d(()=>[t(k(we),{size:18})]),_:1},8,["onClick"])])]),_:2},1024))),128))]))),128)),!k(m)||!k(m).exercises.length?(b(),S("div",Me,"还没有记录，开始训练吧！")):W("",!0)]),t(B,{show:_.value,onClose:e[6]||(e[6]=a=>_.value=!1)},{default:d(()=>[s("div",Ue,[e[22]||(e[22]=s("div",{class:"dialog-title f-title"},"提示",-1)),e[23]||(e[23]=s("div",{class:"dialog-message"},"请选择动作并填写重量和次数",-1)),t(y,{variant:"primary",class:"full-width",onClick:e[5]||(e[5]=a=>_.value=!1)},{default:d(()=>[...e[21]||(e[21]=[w("确认",-1)])]),_:1})])]),_:1},8,["show"]),t(B,{show:l.value,onClose:e[9]||(e[9]=a=>l.value=!1)},{default:d(()=>[e[26]||(e[26]=s("div",{class:"dialog-title f-title is-primary"},"添加/修改备注",-1)),s("div",ze,[D(s("textarea",{class:"form-input remark-textarea","onUpdate:modelValue":e[7]||(e[7]=a=>u.value.remark=a),placeholder:"输入备注内容..."},null,512),[[h,u.value.remark]])]),s("div",Be,[t(y,{variant:"secondary",class:"flex-1",disabled:M.value,onClick:e[8]||(e[8]=a=>l.value=!1)},{default:d(()=>[...e[24]||(e[24]=[w(" 取消",-1)])]),_:1},8,["disabled"]),t(y,{variant:"primary",class:"flex-1",loading:M.value,onClick:le},{default:d(()=>[...e[25]||(e[25]=[w("保存",-1)])]),_:1},8,["loading"])])]),_:1},8,["show"]),t(B,{show:n.value,onClose:e[15]||(e[15]=a=>n.value=!1)},{default:d(()=>[I.value?(b(),S("div",Ee,"编辑："+T(I.value.name),1)):W("",!0),s("div",Ne,[e[27]||(e[27]=s("label",{class:"form-label"},"组类型",-1)),t(g,{modelValue:u.value.setType,"onUpdate:modelValue":e[10]||(e[10]=a=>u.value.setType=a),options:k(i).setTypes},null,8,["modelValue","options"])]),s("div",Le,[e[28]||(e[28]=s("label",{class:"form-label"},"重量",-1)),D(s("input",{type:"number",class:"form-input","onUpdate:modelValue":e[11]||(e[11]=a=>u.value.weight=a),step:"0.5"},null,512),[[h,u.value.weight]])]),s("div",Re,[e[29]||(e[29]=s("label",{class:"form-label"},"单位",-1)),t(g,{modelValue:u.value.unitId,"onUpdate:modelValue":e[12]||(e[12]=a=>u.value.unitId=a),options:k(i).units.map(a=>({value:a.id,label:a.name}))},null,8,["modelValue","options"])]),s("div",je,[e[30]||(e[30]=s("label",{class:"form-label"},"次数 (Reps)",-1)),D(s("input",{type:"number",class:"form-input","onUpdate:modelValue":e[13]||(e[13]=a=>u.value.reps=a)},null,512),[[h,u.value.reps]])]),s("div",Ae,[t(y,{variant:"secondary",class:"flex-1",disabled:U.value,onClick:e[14]||(e[14]=a=>n.value=!1)},{default:d(()=>[...e[31]||(e[31]=[w("取消 ",-1)])]),_:1},8,["disabled"]),t(y,{variant:"primary",class:"flex-1",loading:U.value,onClick:ie},{default:d(()=>[...e[32]||(e[32]=[w("保存",-1)])]),_:1},8,["loading"])])]),_:1},8,["show"]),t(B,{show:p.value,onClose:e[18]||(e[18]=a=>p.value=!1)},{default:d(()=>[j.value?(b(),S("div",He,[e[35]||(e[35]=s("div",{class:"dialog-title f-title is-danger"},"最后一组",-1)),e[36]||(e[36]=s("div",{class:"dialog-message"},"这是今天最后一组，删除后将清除今日记录并返回首页，确定吗？",-1)),s("div",qe,[t(y,{variant:"secondary",class:"flex-1",disabled:V.value,onClick:e[16]||(e[16]=a=>p.value=!1)},{default:d(()=>[...e[33]||(e[33]=[w("取消",-1)])]),_:1},8,["disabled"]),t(y,{variant:"danger",class:"flex-1",loading:V.value,onClick:J},{default:d(()=>[...e[34]||(e[34]=[w("确定删除 ",-1)])]),_:1},8,["loading"])])])):(b(),S("div",We,[e[39]||(e[39]=s("div",{class:"dialog-title f-title"},"确认删除",-1)),e[40]||(e[40]=s("div",{class:"dialog-message"},"确定要删除此组训练记录吗？",-1)),s("div",Ge,[t(y,{variant:"secondary",class:"flex-1",disabled:V.value,onClick:e[17]||(e[17]=a=>p.value=!1)},{default:d(()=>[...e[37]||(e[37]=[w("取消",-1)])]),_:1},8,["disabled"]),t(y,{variant:"danger",class:"flex-1",loading:V.value,onClick:J},{default:d(()=>[...e[38]||(e[38]=[w("确定删除 ",-1)])]),_:1},8,["loading"])])]))]),_:1},8,["show"])])}}}),Qe=ge(Je,[["__scopeId","data-v-56b1fc95"]]);export{Qe as default};
