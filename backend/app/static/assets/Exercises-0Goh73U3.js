import{e as N,u as U,o as j,f as A,g as _,j as s,F as B,k as P,h as o,i as r,r as d,a as x,b as G,p as y,q as m,t as C,x as q,l as F,s as I,v as O,y as E,d as R,_ as H}from"./index-B2-oSflo.js";import{P as J,a as K,T as Q}from"./trash-2-zQpmGgqF.js";const W={class:"exercises-page"},X={class:"scroll-area"},Y={class:"muscle-group-header f-title"},Z={class:"exercise-info"},ee={class:"exercise-name"},se={class:"exercise-actions"},ae={class:"dialog-title f-title is-primary"},le={class:"form-group"},te={class:"form-group"},oe={class:"dialog-actions"},ne={class:"dialog-message"},ie={class:"dialog-actions"},re=N({__name:"Exercises",setup(ue){const u=U();R();const V=d([]),c=d(!1),v=d(!1),i=d(null),n=d({name:"",target_muscle:""}),f=d(!1),p=d(!1),k=async()=>{const a=await x.listExercises();u.exercises=a,V.value=a},S=G(()=>{const a={};return V.value.forEach(e=>{const l=e.targetMuscle||"其他";a[l]||(a[l]=[]),a[l].push(e)}),Object.entries(a).map(([e,l])=>({muscle:e,items:l.sort((w,b)=>w.name.localeCompare(b.name))})).sort((e,l)=>e.muscle.localeCompare(l.muscle))}),$=()=>{i.value=null,n.value={name:"",target_muscle:u.muscleGroups[0]||""},c.value=!0},h=a=>{i.value=a,n.value={name:a.name,target_muscle:String(a.targetMuscle)},c.value=!0},T=async()=>{if(!(!n.value.name||!n.value.target_muscle)){f.value=!0;try{i.value?await x.updateExercise(i.value.id,n.value):await x.createExercise(n.value),c.value=!1,await k()}finally{f.value=!1}}},z=a=>{i.value=a,v.value=!0},M=async()=>{if(i.value){p.value=!0;try{await x.deleteExercise(i.value.id),v.value=!1,await k()}finally{p.value=!1}}};return j(async()=>{u.setPageTitle("训练动作"),u.setFooterVisible(!0),u.setPageFooter([{key:"add",label:"新增训练动作",variant:"primary",class:"flex-1",icon:J,onClick:$}]),await k(),u.hideLoading()}),A(()=>{u.clearPageFooter()}),(a,e)=>{const l=y("FButton"),w=y("FCard"),b=y("FSelect"),D=y("FDialog");return m(),_("div",W,[s("div",X,[(m(!0),_(B,null,P(S.value,t=>(m(),_("div",{key:t.muscle,class:"muscle-group-section"},[s("div",Y,C(t.muscle),1),(m(!0),_(B,null,P(t.items,g=>(m(),q(w,{key:g.id,margin:"0 0 0.75rem 0",padding:"0.75rem 1rem","border-radius":"1rem",class:"exercise-card"},{default:r(()=>[s("div",Z,[s("div",ee,C(g.name),1)]),s("div",se,[o(l,{variant:"ghost",size:"icon",onClick:L=>h(g)},{default:r(()=>[o(F(K),{size:18})]),_:1},8,["onClick"]),o(l,{variant:"danger",size:"icon",onClick:L=>z(g)},{default:r(()=>[o(F(Q),{size:18})]),_:1},8,["onClick"])])]),_:2},1024))),128))]))),128))]),o(D,{show:c.value,onClose:e[3]||(e[3]=t=>c.value=!1)},{default:r(()=>[s("div",ae,C(i.value?"编辑动作":"新增动作"),1),s("div",le,[e[6]||(e[6]=s("label",{class:"form-label"},"动作名称",-1)),I(s("input",{type:"text",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=t=>n.value.name=t),placeholder:"例如：卧推"},null,512),[[O,n.value.name]])]),s("div",te,[e[7]||(e[7]=s("label",{class:"form-label"},"目标肌肉",-1)),o(b,{modelValue:n.value.target_muscle,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.target_muscle=t),options:F(u).muscleGroups.map(t=>({value:t,label:t}))},null,8,["modelValue","options"])]),s("div",oe,[o(l,{variant:"secondary",class:"flex-1",disabled:f.value,onClick:e[2]||(e[2]=t=>c.value=!1)},{default:r(()=>[...e[8]||(e[8]=[E("取消",-1)])]),_:1},8,["disabled"]),o(l,{variant:"primary",class:"flex-1",loading:f.value,onClick:T},{default:r(()=>[...e[9]||(e[9]=[E("保存",-1)])]),_:1},8,["loading"])])]),_:1},8,["show"]),o(D,{show:v.value,onClose:e[5]||(e[5]=t=>v.value=!1)},{default:r(()=>[e[12]||(e[12]=s("div",{class:"dialog-title f-title is-danger"},"确认删除",-1)),s("div",ne,"确定要删除操作“"+C(i.value?.name)+"”吗？此操作不可撤销。",1),s("div",ie,[o(l,{variant:"secondary",class:"flex-1",disabled:p.value,onClick:e[4]||(e[4]=t=>v.value=!1)},{default:r(()=>[...e[10]||(e[10]=[E("取消 ",-1)])]),_:1},8,["disabled"]),o(l,{variant:"danger",class:"flex-1",loading:p.value,onClick:M},{default:r(()=>[...e[11]||(e[11]=[E("确定删除",-1)])]),_:1},8,["loading"])])]),_:1},8,["show"])])}}}),ve=H(re,[["__scopeId","data-v-a41a3954"]]);export{ve as default};
